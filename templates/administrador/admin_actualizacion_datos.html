<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard Usuario</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css') }}" />
 
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/formularios.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nosotros.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/calendario.css') }}" />

  <style>

    .i{
        height: 200px;
        width: 100%;
    }

    .pedido1 {
      color: black;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      background-color: #fff;
      width: 80%;
      margin-left: 10%;
      border:1px solid #e6e6e6;
    }

    .productos {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
      color: black;
    }

    .producto {
      border: 1px solid #ccc;
      background: linear-gradient(90deg, var(--primary-green), var(--accent-green));
      border-radius: 8px;
      padding: 10px;
      width: 200px;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
      text-align: center;
      color: white;
    }

    .producto img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
    }

     .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 50%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }
     .name{
      margin-left: 10%;
     }

     .control{
      position: relative;
      display: flex;
      left: 10%;
     }

     .control a, button{
      text-decoration: none;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      height: 60px;
      width: auto;
      margin: 0 0 10px 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
     }

     .control a, button:hover{
      background-color: transparent;
      border: 1px solid ;
     }

     .boton button{
      margin-top: 10px;
      background-color: transparent;
      border: 1px solid white;
      color: white;
      padding: 10px 20px;
      position: relative;
      margin-left: 80%;
     }

    .boton button:hover{
      background-color: #fff;
      background-color: #fff;
      border:1px solid black;
      color: black;
      bottom: 2px;
     }

     input{
      float: left;
     }

     
    

  </style>

</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top bg-light shadow-sm">
  <div class="container-fluid px-4">
    <!-- Marca -->
    <a class="navbar-brand fw-bold" href="{{ url_for('index') }}">
      Casa en el √Årbol
    </a>

    <!-- Bot√≥n hamburguesa -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain"
      aria-controls="navbarMain" aria-expanded="false" aria-label="Men√∫">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Contenido colapsable -->
    <div class="collapse navbar-collapse" id="navbarMain">
      <!-- Buscador -->
      <div class="search-container mx-auto d-none d-md-block">
        <input class="form-control" type="search" placeholder="¬øQu√© est√°s buscando hoy?" aria-label="Buscar" id="searchInput">
      </div>

      <!-- Iconos alineados a la derecha -->
      <div class="d-flex align-items-center gap-3 ms-auto">
        <!-- Favoritos -->
        <a href="#" class="nav-icon" aria-label="Favoritos">
          <i class="bi bi-heart fs-4"></i>
        </a>

        <!-- Dropdown usuario -->
        <div class="dropdown">
          <a class="nav-icon dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-label="Cuenta de usuario">
            <i class="bi bi-person fs-4"></i>
          </a>
          {% if session.get('user_id') %}
          <!-- Usuario logueado -->
         <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{{ url_for('login') }}"><i class="bi bi-box-arrow-in-right me-2"></i>Iniciar sesi√≥n</a></li>
            <li><a class="dropdown-item" href="{{ url_for('register') }}"><i class="bi bi-person-plus me-2"></i>Registrarse</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-key me-2"></i>Recuperar contrase√±a</a></li>
          </ul>
          {% else %}
          <!-- Usuario no logueado -->
         
            <ul class="dropdown-menu dropdown-menu-end p-3" style="width: 250px;">
          <div class="d-flex align-items-center mb-3">
        <div class="rounded-circle bg-light border text-dark fw-bold d-flex align-items-center justify-content-center me-2"
            style="width: 45px; height: 45px; font-size: 16px;">
            {{ session.get('iniciales', '??') }}
        </div>
        <strong class="text-uppercase">
            {{ session.get('username', 'Invitado') }}
        </strong>
        </div>

            <li><a class="dropdown-item" href="{{ url_for('cliente.actualizacion_datos') }}">Perfil</a></li>
            <li><a class="dropdown-item" href="">Historial</a></li>
            <li><a class="dropdown-item" href="#">Mis pedidos</a></li>
            <li>
          <a class="dropdown-item" 
          {% if current_user.Rol == 'admin' %}
            href="{{ url_for('admin.actualizacion_datos') }}"
          {% else %}
            href="{{ url_for('cliente.resenas') }}"
          {% endif %}>
          Rese√±as
        </a>

        </li>
            <li><a class="dropdown-item" href="{{ url_for('cliente.ver_notificaciones_cliente') }}">Notificaciones</a></li>
            <div class="mt-3">
              <a href="{{ url_for('auth.logout') }}" class="btn btn-primary w-100">Cerrar sesi√≥n</a>
            </div>
          </ul>
          {% endif %}
        </div>

        <!-- Carrito -->
        <a href="#" class="nav-icon position-relative" onclick="toggleCart()" aria-label="Carrito de compras">
          <i class="bi bi-cart fs-4"></i>
          <span class="cart-badge" id="cart-count">0</span>
        </a>
      </div>
    </div>
  </div>
</nav>

<!-- Bloque de mensajes flash espec√≠ficos de actualizaci√≥n de datos -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      {% if category.startswith('actualizacion_datos') or category.startswith('borrar_direccion') %}
        <div 
          class="alert 
                 {% if 'success' in category %}alert-success
                 {% elif 'warning' in category %}alert-warning
                 {% elif 'danger' in category %}alert-danger
                 {% else %}alert-info{% endif %} 
                 alert-dismissible fade show mt-3"
          role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endwith %}

    {% if session.get('show_welcome_modal') %}
<!-- Modal de bienvenida -->
<div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header border-0">
        <h5 class="modal-title w-100" id="welcomeModalLabel">
          ¬°Bienvenid@{{ ', ' + session['username'] if session['username'] else '' }}!
        </h5>
      </div>
      <div class="modal-body">
        <p class="mb-4">Gracias por iniciar sesi√≥n en <strong>Casa en el √Årbol</strong>.</p>
        <a href="{{ url_for('dashboard') }}" class="btn custom-btn px-4 py-2">Ir a la p√°gina principal</a>
      </div>
    </div>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
    welcomeModal.show();
  });
</script>


{% set _ = session.pop('show_welcome_modal') %}
{% endif %}


   
    <div class="section-menu py-3 bg-white shadow-sm" style="margin-top: 80px;">
        <div class="container">
            <ul class="nav justify-content-center flex-wrap">
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#" onclick="filterProducts('all')">
                        <i class="bi bi-grid me-1"></i>CATEGOR√çAS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="{{ url_for('nosotros') }}">
                        <i class="bi bi-info-circle me-1"></i>NOSOTROS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="{{ url_for('admin.catalogo') }}" onclick="scrollToCatalog()">
                        <i class="bi bi-collection me-1"></i>CAT√ÅLOGO
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#" onclick="filterProducts('ofertas')">
                        <i class="bi bi-tag me-1"></i>OFERTAS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#">
                        <i class="bi bi-shield-check me-1"></i>GARANT√çAS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="{{ url_for('cliente.instalaciones_home') }}">
                        <i class="bi bi-tools me-1"></i>INSTALACIONES
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fw-semibold text-dark" href="#">
                        <i class="bi bi-chat-dots me-1"></i>CHATBOT
                    </a>
                </li>
            </ul>
        </div>
    </div>
<div class="container-fluid mt-4">
  <div class="row">
 
    <div class="col-md-3 col-lg-2 mb-4">
      <div class="sidebar shadow-sm">
        <h4>üåø HOLA!</h4>
        <a id="menu-perfil" class="active"><i class="bi bi-person-circle me-2"></i>Perfil</a>
        <a id="menu-direcciones"><i class="bi bi-geo-alt me-2"></i>Direcciones</a>
        <a id="menu-pedidos"><i class="bi bi-box-seam me-2"></i>Pedidos</a>
        <a id="menu-calendario"><i class="bi bi-calendar me-2"></i>Calendario</a>
        <a href="{{ url_for('admin.dashboard') }}"><i class="bi bi-box-arrow-right me-2"></i>Salir</a>
      </div>
    </div>

  
    <div class="col-md-9 col-lg-10">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mt-3">
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

 
      <div id="seccion-perfil" class="card shadow-sm p-4">
        <div class="profile-header mb-4">
          <h5 class="mb-0">PERFIL</h5>
        </div>
        <form method="POST" action="{{ url_for('cliente.actualizacion_datos') }}">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" name="nombre" class="form-control" value="{{ usuario.Nombre }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Apellido</label>
              <input type="text" name="apellido" class="form-control" value="{{ usuario.Apellido or '' }}" />
            </div>
            <div class="col-md-12">
              <label class="form-label">Email</label>
              <input type="email" name="correo" class="form-control" value="{{ usuario.Correo }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">G√©nero</label>
              <input type="text" name="genero" class="form-control" value="{{ usuario.Genero or '' }}" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Tel√©fono</label>
              <input type="tel" name="telefono" class="form-control" value="{{ usuario.Telefono or '' }}" />
            </div>
            <div class="col-12 text-end">
              <button type="submit" class="btn btn-green mt-3">Guardar cambios</button>
            </div>
          </div>
        </form>
      </div>
      

      <div id="seccion-direcciones" class="card shadow-sm p-4" style="display:none;">
        <div class="profile-header mb-4">
          <h5 class="mb-0">DIRECCIONES</h5>
          <button type="button" class="btn btn-green btn-sm" data-bs-toggle="modal" data-bs-target="#modalDireccion">
            <i class="bi bi-plus-lg me-1"></i>A√±adir direcci√≥n
          </button>
        </div>
        <div class="list-group">
          {% for dir in direcciones %}
            <div class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
              <div>
                <div><strong>Direcci√≥n:</strong> {{ dir.Direccion }}</div>
                <div><strong>Ciudad:</strong> {{ dir.Ciudad }}</div>
                <div><strong>Departamento:</strong> {{ dir.Departamento }}</div>
                <div><strong>Pa√≠s:</strong> {{ dir.Pais }}</div>
              </div>
              <form action="{{ url_for('cliente.borrar_direccion', id_direccion=dir.ID_Direccion) }}" method="POST">
                <button type="submit" class="btn btn-link text-danger d-flex align-items-center gap-1 p-0">
                  <i class="bi bi-trash fs-5"></i> Borrar
                </button>
              </form>
            </div>
          {% else %}
            <p class="text-muted">No tienes direcciones registradas.</p>
          {% endfor %}
        </div>
      </div>

      <!-- NUEVA SECCI√ìN: REGISTRAR √ìRDEN DE ENV√çO -->
      <div id="seccion-pedidos" class="card shadow-sm p-4" style="display:none;">
        <div class="profile-header mb-4">
          <h5 class="mb-0">REGISTRAR √ìRDEN DE ENV√çO</h5>
        </div>
        <div class="control">
          <button id="ocultarInputsBtn" style="display:none; background: linear-gradient(90deg, var(--primary-green), var(--accent-green));" >x</button>
          <button class="btn btn-primary mt-3"
              id="abrirModalAsignacionBtn"
              style="display:none; border-radius: 10px; border: 0; position: relative; bottom: 17px; background: linear-gradient(90deg, var(--primary-green), var(--accent-green));">
            Confirmar Asignaci√≥n
          </button>
          <button class="btn btn-success" 
                  id="mostrarAsignacionBtn"
                  style="border-radius: 10px; border: 0; background: linear-gradient(90deg, var(--primary-green), var(--accent-green));">
            Asignar pedidos
          </button>
          <a href="/admin/control_pedidos" style="background: linear-gradient(90deg, var(--primary-green), var(--accent-green));">control de pedidos</a>
        </div>
        {% for pedido in pedidos %}
          <div class="name"><p><strong>Usuario:</strong> {{ pedido.usuario }}</p></div>
            <input type="checkbox" class="seleccion-pedido" value="{{ pedido.id }}" data-empleado="{{ pedido.id_empleado if pedido.id_empleado else '' }}"  style="display: none; position: relative; right: 45%; top: 150px; border: none;" />

            <div class="pedido1">
              <h5>ID Pedido: {{ pedido.id }}</h5>
              <p><strong>Fecha:</strong> {{ pedido.fecha }}</p>

              <div class="productos">
                {% for producto in pedido.productos %}
                  <div class="producto">
                    {% if producto.imagen %}
                      <img src="{{ producto.imagen }}" alt="Imagen del producto" width="150" style="margin-top: 10px;">
                    {% else %}
                      <p><em>Sin imagen</em></p>
                    {% endif %}
                    <p><strong>{{ producto.nombre }}</strong></p>
                    <p>Cantidad: {{ producto.cantidad }}</p>
                  </div>
              </div>
        
              <div class="boton"><button id="miboton" style="background-color: transparent;" onclick="abrirModal('{{ pedido.id }}')">Ver Detalles</button></div>
                <p><strong>Total del Pedido:</strong> ${{ pedido.total }}</p>
              </div>
            </div>
          </div>
        {%endfor%}
        </div>  
      </div>
      
      <!-- SECCI√ìN: CALENDARIO -->
      <div id="seccion-calendario" class="card shadow-sm p-4" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">üìÖ Calendario de Asignaciones</h5>

          <div class="d-flex align-items-center gap-2">
            <button id="prevMonthBtn" class="btn btn-sm btn-outline-success">&lt;</button>
              <span id="monthYearDisplay" class="fw-bold"></span>
            <button id="nextMonthBtn" class="btn btn-sm btn-outline-success">&gt;</button>

            <select id="yearSelect" class="form-select form-select-sm w-auto ms-2"></select>
            <div class="container mt-4">

              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <button id="btn-hoy" class="btn btn-outline-primary me-2">Hoy</button>
                  <button id="btn-mes" class="btn btn-outline-secondary me-2">Mes</button>
                  <button id="btn-a√±o" class="btn btn-outline-secondary">A√±o</button>
                </div>

                <h4 id="titulo-mes" class="text-capitalize m-0"></h4>

                <div class="d-flex align-items-center">
                  <select id="select-usuario" class="form-select me-2" style="width:200px">
                    <option value="admin">Mi calendario</option>
                  </select>
                  <button id="btn-nuevo-evento" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Crear evento
                  </button>
                </div>
              </div>

              <div id="calendar-grid" class="d-grid" 
                  style="grid-template-columns: repeat(7, 1fr); gap: 8px;"></div>
              </div>
            </div>
          </div>
          <div id="calendar" class="calendar-grid"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="modalDireccion" tabindex="-1" aria-labelledby="modalDireccionLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content p-4 rounded-4">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold" id="modalDireccionLabel">A√ëADIR DIRECCI√ìN</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
       
        <form method="POST" action="{{ url_for('cliente.agregar_direccion') }}">
          <div class="mb-3">
            <label for="pais" class="form-label">Pa√≠s</label>
            <select name="pais" id="pais" class="form-select rounded-pill">
              <option selected>Colombia</option>
            </select>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="departamento" class="form-label">Departamento</label>
              <select name="departamento" id="departamento" class="form-select rounded-pill">
          <option selected>Bogot√°, D.C.</option>
        </select>

            </div>
            <div class="col-md-6">
              <label for="municipio" class="form-label">Municipio</label>
              <select name="municipio" id="municipio" class="form-select rounded-pill">
              <option selected>Bogot√°, D.C.</option>
            </select>

            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="direccion" class="form-label">Direcci√≥n</label>
              <input type="text" name="direccion" id="direccion" class="form-control rounded-pill" placeholder="Direcci√≥n" required />
            </div>
            <div class="col-md-6">
              <label for="infoAdicional" class="form-label">Informaci√≥n adicional</label>
              <input type="text" name="infoAdicional" id="infoAdicional" class="form-control rounded-pill" placeholder="Apto. 201, torre 5" />
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="barrio" class="form-label">Barrio</label>
              <input type="text" name="barrio" id="barrio" class="form-control rounded-pill" placeholder="Barrio" />
            </div>
            <div class="col-md-6">
              <label for="destinatario" class="form-label">Destinatario</label>
              <input type="text" name="destinatario" id="destinatario" class="form-control rounded-pill" placeholder="Qui√©n recibe" />
            </div>
          </div>

          <div class="text-end mt-4">
            <button type="submit" class="btn btn-green px-4 py-2 rounded-pill">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="modalGuardado" tabindex="-1" aria-labelledby="modalGuardadoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4 rounded-4 text-center">
      <h5 class="modal-title mb-3 text-success fw-bold" id="modalGuardadoLabel">
        Direcci√≥n guardada
      </h5>
      <p>Tu nueva direcci√≥n ha sido registrada correctamente.</p>
      <div class="d-flex justify-content-center gap-3 mt-3">
        <button type="button" class="btn btn-outline-secondary px-4 rounded-pill" data-bs-dismiss="modal">Cerrar</button>
       
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="modalConfirmarBorrar" tabindex="-1" aria-labelledby="modalConfirmarBorrarLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4 rounded-4 text-center">
      <h5 class="modal-title mb-3 text-danger fw-bold" id="modalConfirmarBorrarLabel">
        ¬øEliminar esta direcci√≥n?
      </h5>
      <p>Esta acci√≥n no se puede deshacer. ¬øSeguro que deseas continuar?</p>
      <div class="d-flex justify-content-center gap-3 mt-3">
        <button type="button" class="btn btn-outline-secondary px-4 rounded-pill" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" id="btnConfirmarBorrar" class="btn btn-danger px-4 rounded-pill">Borrar</button>
      </div>
    </div>
  </div>
</div>




<div class="modal fade" id="modalEliminado" tabindex="-1" aria-labelledby="modalEliminadoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4 rounded-4 text-center">
      <h5 class="modal-title mb-3 text-success fw-bold" id="modalEliminadoLabel">
        Direcci√≥n eliminada
      </h5>
      <p>La direcci√≥n fue eliminada correctamente.</p>
      <div class="d-flex justify-content-center mt-3">
        <button type="button" class="btn btn-success px-4 rounded-pill" data-bs-dismiss="modal">
          Entendido
        </button>
      </div>
    </div>
  </div>
</div>



    <!-- Modal -->
    <!-- Modal -->
<!-- Modal -->
<div id="modal-{{ pedido.id }}" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModal('{{ pedido.id }}')">&times;</span>

    {% set info = detalles[pedido.id] if pedido.id in detalles else None %}
    {% if info %}
      <p><strong>Nombre:</strong> {{ info.Nombre_Cliente }}</p>
      <p><strong>Tel√©fono:</strong> {{ info.Telefono }}</p>
      <p><strong>Direcci√≥n:</strong> {{ info.Direccion }}</p>

      <hr>
      <h6>Productos:</h6>
      <ul>
        {% for p in info.Productos %}
          <li>{{ p.Producto }} - Cantidad: {{ p.Cantidad }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No hay detalles para este pedido.</p>
    {% endif %}
  </div>
</div>


  {% endfor %}

  <!-- Modal para asignar empleado -->
<!-- Modal para asignar empleado -->
<!-- Modal para asignar empleado -->
<!-- Modal para asignar empleado -->
<div id="modal-empleado" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModalEmpleado()">&times;</span>
    <h5>Asignar empleado y programar env√≠o</h5>
    <div id="mensajesAsignacion"></div>

    <!-- √önico formulario -->
    <form id="formAsignacion">
  <input type="hidden" name="pedidosSeleccionados" id="pedidosSeleccionados">
  <select name="empleado_id" id="empleado_id" required>
    <option value="">-- Selecciona empleado --</option>
    {% for emp in empleados %}
      <option value="{{ emp.ID_Empleado }}">{{ emp.Nombre }}</option>
    {% endfor %}
  </select>

  <input type="date" name="fecha" id="fecha" required>
  <input type="time" name="hora" id="hora" required>

  <button id="btnEnviarAsignacion" type="button">Asignar</button>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

</form>

  </div>
</div>
</div>
<!-- FIN SECCI√ìN: REGISTRAR √ìRDEN DE ENV√çO -->




<div class="carousel-container">
  <div class="carousel-track">
    <div class="carousel-item"><i class="bi bi-truck"></i> Env√≠os a nivel nacional</div>
    <div class="carousel-item"><i class="bi bi-cart"></i> Compra f√°cil y segura</div>
    <div class="carousel-item"><i class="bi bi-award"></i> Excelente calidad</div>
    <div class="carousel-item"><i class="bi bi-headset"></i> Productos personalizados</div>
    <!-- Repite para que parezca infinito -->
    <div class="carousel-item"><i class="bi bi-truck"></i> Env√≠os a nivel nacional</div>
    <div class="carousel-item"><i class="bi bi-cart"></i> Compra f√°cil y segura</div>
    <div class="carousel-item"><i class="bi bi-award"></i> Excelente calidad</div>
     <div class="carousel-item"><i class="bi bi-headset"></i> Productos personalizados</div>
  </div>
</div>


<!-- Footer suscripci√≥n -->
    <section class="footer-suscripcion mt-5 bg-dark text-light py-4">
        <div class="container">
            <div class="row footer-columns mt-4">
                <div class="col-md-3 footer-col">
                    <h3><strong>Casa en el √Årbol</strong></h3>
                    <p>Dise√±amos y fabricamos muebles √∫nicos con alma natural.</p>
                </div>
                <div class="col-md-3 footer-col">
                    <h5>Informaci√≥n</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-light text-decoration-none">Pol√≠tica de privacidad</a></li>
                        <li><a href="#" class="text-light text-decoration-none">T√©rminos y condiciones</a></li>
                        <li><a href="#" class="text-light text-decoration-none">Env√≠os y devoluciones</a></li>
                    </ul>
                </div>
                <div class="col-md-3 footer-col">
                    <h5>Horario de Atenci√≥n</h5>
                    <p>
                        Lunes a Viernes: 9:00 a.m. - 6:00 p.m.<br />
                        S√°bados: 10:00 a.m. - 4:00 p.m.
                    </p>
                    <p><strong>Email:</strong> casaenelarbol236@gmail.com</p>
                </div>
                <div class="col-md-3 footer-col">
                    <h5>Cont√°ctanos</h5>
                    <div class="social-icons d-flex gap-3 fs-4">
                        <a href="#" class="text-light"><i class="bi bi-whatsapp"></i></a>
                        <a href="#" class="text-light"><i class="bi bi-facebook"></i></a>
                        <a href="#" class="text-light"><i class="bi bi-instagram"></i></a>
                        <a href="#" class="text-light"><i class="bi bi-youtube"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </section>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/actualizacion.js') }}"></script>

<!-- üîπ Script para alternar secciones -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const perfil = document.getElementById('seccion-perfil');
  const direcciones = document.getElementById('seccion-direcciones');
  const pedidos = document.getElementById('seccion-pedidos');

  const menuPerfil = document.getElementById('menu-perfil');
  const menuDirecciones = document.getElementById('menu-direcciones');
  const menuPedidos = document.getElementById('menu-pedidos');
  const calendario = document.getElementById('seccion-calendario');
  const menuCalendario = document.getElementById('menu-calendario');

  function mostrarSeccion(seccion) {
    perfil.style.display = 'none';
    direcciones.style.display = 'none';
    pedidos.style.display = 'none';
    seccion.style.display = 'block';
  }

  menuPerfil.addEventListener('click', () => mostrarSeccion(perfil));
  menuDirecciones.addEventListener('click', () => mostrarSeccion(direcciones));
  menuPedidos.addEventListener('click', () => mostrarSeccion(pedidos));
  menuCalendario.addEventListener('click', () => mostrarSeccion(calendario));

});
</script>

 <script>
    function abrirModal(id) {
      document.getElementById("modal-" + id).style.display = 'block';
    }

    function cerrarModal(id) {
      document.getElementById("modal-" + id).style.display = 'none';
    }

    window.onclick = function(event) {
      const modales = document.querySelectorAll(".modal");
      modales.forEach(modal => {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    }

      let modoAsignacion = false;

 function activarAsignacion() {
  modoAsignacion = true;
  const checkboxes = document.querySelectorAll(".seleccion-pedido");

  checkboxes.forEach(cb => {
    cb.style.display = 'inline-block';
    cb.addEventListener('change', () => {
      if (cb.checked) {
        cb.parentElement.style.border = "2px solid #28a745"; // resaltado
      } else {
        cb.parentElement.style.border = "none";
      }
    });
  });

  // Ya no creamos el bot√≥n aqu√≠
}



const mostrarAsignacionBtn = document.getElementById('mostrarAsignacionBtn');
const ocultarInputsBtn = document.getElementById('ocultarInputsBtn');
const abrirModalAsignacionBtn = document.getElementById('abrirModalAsignacionBtn');
const btnEnviarAsignacion = document.getElementById("btnEnviarAsignacion");
const inputs = document.querySelectorAll('input.seleccion-pedido');

// Mostrar checkboxes
mostrarAsignacionBtn.addEventListener('click', () => {
  inputs.forEach(input => input.style.display = 'inline-block');
  ocultarInputsBtn.style.display = 'inline-block';
  abrirModalAsignacionBtn.style.display = 'inline-block';
});

// Mostrar modal de asignaci√≥n
abrirModalAsignacionBtn.addEventListener('click', mostrarModalEmpleado);

// Enviar formulario dentro del modal
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("formAsignacion");

  btnEnviarAsignacion.addEventListener("click", async () => {
    const formData = new FormData(form);

    try {
      const response = await fetch("/admin/asignar_calendario", {
        method: "POST",
        body: formData
      });

      const data = await response.json();
      console.log("‚úÖ Respuesta del servidor:", data);

      if (data.success) {
        alert("Pedidos asignados correctamente üéâ");
        location.reload();
      } else {
        alert("‚ö†Ô∏è Error: " + data.message);
      }
    } catch (err) {
      console.error("‚ùå Error en fetch:", err);
      alert("No se pudo conectar con el servidor");
    }
  });
});


// Evento para el bot√≥n Confirmar Asignaci√≥n
abrirModalAsignacionBtn.addEventListener('click', mostrarModalEmpleado);


function mostrarModalEmpleado() {
  const seleccionados = Array.from(document.querySelectorAll('input.seleccion-pedido:checked'));

  if (seleccionados.length === 0) {
    alert('Por favor selecciona al menos un pedido para asignar.');
    return;
  }

  const pedidosIds = seleccionados.map(input => input.value);
  document.getElementById('pedidosSeleccionados').value = pedidosIds.join(',');

  // Construir mensajes
  let mensajes = "";
  seleccionados.forEach(input => {
    console.log("Pedido:", input.value, "Empleado asignado:", input.dataset.empleado);
    if (input.dataset.empleado && input.dataset.empleado !== "") {
      mensajes += `<p style="color:red;"> El pedido ${input.value} ya est√° asignado a un empleado</p>`;
    }
  });

  document.getElementById("mensajesAsignacion").innerHTML = mensajes;

  // Abrir modal
  document.getElementById('modal-empleado').style.display = 'block';
}



// Para cerrar el modal-empleado (ya tienes la funci√≥n para el modal normal, aqu√≠ la funci√≥n para el modal-empleado)
function cerrarModalEmpleado() {
  document.getElementById('modal-empleado').style.display = 'none';
}

// Bot√≥n X -> ocultar inputs y botones
ocultarInputsBtn.addEventListener('click', () => {
  inputs.forEach(input => {
    input.style.display = 'none';
    input.checked = false; // opcional: desmarca todo
    input.parentElement.style.border = "1px solid #e6e6e6"; // restaurar borde original
  });

  ocultarInputsBtn.style.display = 'none';
  confirmarAsignacionBtn.style.display = 'none';
});


</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const calendar = document.getElementById("calendar");
  const monthYearDisplay = document.getElementById("monthYearDisplay");
  const prevMonthBtn = document.getElementById("prevMonthBtn");
  const nextMonthBtn = document.getElementById("nextMonthBtn");
  const yearSelect = document.getElementById("yearSelect");

  let currentDate = new Date();

  // Llenar selector de a√±os (5 antes y 5 despu√©s del actual)
  const currentYear = currentDate.getFullYear();
  for (let y = currentYear - 5; y <= currentYear + 5; y++) {
    const opt = document.createElement("option");
    opt.value = y;
    opt.textContent = y;
    if (y === currentYear) opt.selected = true;
    yearSelect.appendChild(opt);
  }

  function renderCalendar() {
    calendar.innerHTML = "";

    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);

    monthYearDisplay.textContent = firstDay.toLocaleString("es-ES", {
      month: "long",
      year: "numeric"
    });

    // D√≠as vac√≠os antes del primer d√≠a del mes
    for (let i = 0; i < firstDay.getDay(); i++) {
      const empty = document.createElement("div");
      calendar.appendChild(empty);
    }

    // D√≠as del mes
    for (let d = 1; d <= lastDay.getDate(); d++) {
      const day = document.createElement("div");
      day.classList.add("calendar-day");
      day.textContent = d;

      const today = new Date();
      if (
        d === today.getDate() &&
        month === today.getMonth() &&
        year === today.getFullYear()
      ) {
        day.classList.add("today");
      }

      calendar.appendChild(day);
    }
  }

  // Navegar entre meses
  prevMonthBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  nextMonthBtn.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  // Cambiar a√±o (manteniendo el mes actual)
  yearSelect.addEventListener("change", (e) => {
    const selectedYear = parseInt(e.target.value);
    currentDate.setFullYear(selectedYear);
    renderCalendar();
  });

  renderCalendar();
});
</script>
<script src="{{ url_for('static', filename='js/calendario.js') }}"></script>
</body>
</html>
