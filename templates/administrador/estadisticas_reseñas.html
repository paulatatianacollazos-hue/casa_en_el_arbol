{% extends "administrador/admin_dashboard.html" %}
{% block title %}ğŸ“Š EstadÃ­sticas de ReseÃ±as{% endblock %}

{% block content %}
<h2 class="mb-4">ğŸ“ˆ EstadÃ­sticas de ReseÃ±as (solo administradores)</h2>
<canvas id="graficoResenas"></canvas>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function cargarEstadisticas() {
  // AquÃ­ se podrÃ­an cargar reseÃ±as desde localStorage o desde un JSON local
  const reseÃ±as_productos = JSON.parse(localStorage.getItem("reseÃ±as") || "[]");
  const reseÃ±as_pedidos = JSON.parse(localStorage.getItem("reseÃ±as_pedidos") || "[]");

  const res = await fetch("/admin/estadisticas_reseÃ±as", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ reseÃ±as_productos, reseÃ±as_pedidos })
  });
  const data = await res.json();

  const meses = ["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
  const labels = data.productos.map(r => meses[r.mes - 1] + " " + r.anio);

  const chartData = {
    labels,
    datasets: [
      {
        label: "â­ Promedio Productos",
        data: data.productos.map(r => r.promedio_estrellas),
        borderColor: "blue",
        backgroundColor: "rgba(0,0,255,0.2)",
        tension: 0.4
      },
      {
        label: "â­ Promedio Pedidos",
        data: data.pedidos.map(r => r.promedio_estrellas),
        borderColor: "green",
        backgroundColor: "rgba(0,255,0,0.2)",
        tension: 0.4
      }
    ]
  };

  new Chart(document.getElementById("graficoResenas"), {
    type: "line",
    data: chartData,
    options: {
      scales: { y: { beginAtZero: true, max: 5 } }
    }
  });
}
cargarEstadisticas();
</script>
{% endblock %}
