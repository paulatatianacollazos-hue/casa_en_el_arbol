{% extends "administrador/admin_dashboard.html" %}
{% block title %}estadisticas | Casa en el √Årbol{% endblock %}
{% block extra_css %}
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Estilos propios -->


  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- JS de estad√≠sticas -->
  <script defer src="{{ url_for('static', filename='js/estadisticas.js') }}"></script>
{%endblock%}
{% block content %}
<body class="containe py-5" style="font-family: 'Poppins', sans-serif;">
  <div style="width: 90%; margin-left: 5%;">
  <h2 class="text-center mb-4"><i class="bi bi-bar-chart"></i> Estad√≠sticas de satisfacci√≥n</h2>

  <!-- üîπ Filtros -->
  <form id="filtros" class="row g-3 mb-4">
    <div class="col-md-3">
      <label class="form-label">Desde</label>
      <input type="date" class="form-control" name="desde">
    </div>
    <div class="col-md-3">
      <label class="form-label">Hasta</label>
      <input type="date" class="form-control" name="hasta">
    </div>
    <div class="col-md-3">
      <label class="form-label">Canal</label>
      <select class="form-select" name="canal">
        <option>Todos</option>
        <option>Web</option>
        <option>App</option>
      </select>
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button type="button" id="btnGen" class="btn btn-success w-100">
        <i class="bi bi-graph-up-arrow me-1"></i> Generar estad√≠sticas
      </button>
    </div>
  </form>

  <!-- üîπ Resumen general -->
  <div class="card mb-4 p-3 text-center shadow-sm">
    <h5 class="fw-semibold mb-2">‚≠ê Promedio general de satisfacci√≥n</h5>
    <h3 id="promedioGeneral" class="text-primary fw-bold">--</h3>
    <div id="txtTotal" class="text-muted small"></div>
  </div>

  <!-- üîπ Gr√°ficos -->
  <div class="row g-3">
    <!-- Distribuci√≥n por estrellas -->
    <div class="col-md-4">
      <div class="card p-3 shadow-sm">
        <h6 class="fw-semibold text-center">Distribuci√≥n de satisfacci√≥n</h6>
        <canvas id="pie" style="max-height: 300px;"></canvas>
      </div>
    </div>

    <!-- Promedio mensual -->
    <div class="col-md-8">
      <div class="card p-3 shadow-sm">
        <h6 class="fw-semibold text-center">Promedio de estrellas por mes</h6>
        <canvas id="bars" style="max-height: 300px;"></canvas>
      </div>
    </div>
  </div>

  <!-- üîπ Comparativa por tipo (productos vs pedidos) -->
  <div class="row mt-4">
    <div class="col-md-6 mx-auto">
      <div class="card p-3 shadow-sm">
        <h6 class="fw-semibold text-center">Rese√±as por tipo</h6>
        <div id="tipoChartContainer" class="text-center"></div>
      </div>
    </div>
  </div>

  <!-- üîπ Tabla de comentarios negativos -->
  <div class="card mt-4 p-3 shadow-sm">
    <h6 class="fw-semibold"><i class="bi bi-emoji-frown text-danger"></i> Comentarios negativos por pedido</h6>
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th>Pedido</th>
            <th>Comentario</th>
          </tr>
        </thead>
        <tbody id="negTable">
          <tr><td colspan="2" class="text-center text-muted">A√∫n no hay datos</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  </div>
  {%endblock%}
  
{% block extra_footer %}
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{%endblock%}

