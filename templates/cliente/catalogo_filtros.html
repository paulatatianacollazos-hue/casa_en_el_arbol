<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo de Productos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .sidebar { border-right: 1px solid #ddd; padding-right: 15px; }
    .producto-item { display: block; }
    .filtro-activo { font-weight: bold; }
  </style>
</head>
<body>
<div class="container-fluid mt-4">
  <div class="row">
    <!-- Sidebar filtros -->
    <div class="col-md-3 sidebar">
      <h5>Filtrar por Material</h5>
      {% for material in materiales %}
        <div>
          <input type="checkbox" class="filtro-material" value="{{ material }}"> {{ material }}
        </div>
      {% endfor %}

      <h5 class="mt-3">Filtrar por Color</h5>
      {% for color in colores %}
        <div>
          <input type="checkbox" class="filtro-color" value="{{ color }}"> {{ color }}
        </div>
      {% endfor %}

      <h5 class="mt-3">Filtrar por Precio</h5>
      <div>
        Min: <input type="number" id="precio-min" class="form-control mb-2">
        Max: <input type="number" id="precio-max" class="form-control mb-2">
        <button id="filtrar-precio" class="btn btn-primary btn-sm">Filtrar</button>
      </div>
    </div>

    <!-- Contenido productos -->
    <div class="col-md-9">
      <div class="mb-3">
        <h5>Categorías</h5>
        {% for categoria in categorias %}
          <button class="btn btn-outline-primary btn-sm filtro-categoria" data-categoria="{{ categoria.ID_Categoria }}">{{ categoria.NombreCategoria }}</button>
        {% endfor %}
        <button class="btn btn-outline-secondary btn-sm" id="reset-categoria">Mostrar todos</button>
      </div>

      <div class="row" id="productos-grid">
        {% for producto in productos %}
        <div class="col-md-4 mb-4 producto-item"
             data-categoria="{{ producto.ID_Categoria }}"
             data-material="{{ producto.Material }}"
             data-color="{{ producto.Color }}"
             data-precio="{{ producto.PrecioUnidad }}">
          <div class="card h-100">
            <img src="{{ producto.imagenes[0].ruta if producto.imagenes else 'static/img/default.png' }}" class="card-img-top" alt="{{ producto.NombreProducto }}">
            <div class="card-body">
              <h6 class="card-title">{{ producto.NombreProducto }}</h6>
              <p class="card-text">Precio: ${{ producto.PrecioUnidad }}</p>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script>
  // Función de filtrado
  function filtrarProductos() {
    const materiales = Array.from(document.querySelectorAll('.filtro-material:checked')).map(el => el.value);
    const colores = Array.from(document.querySelectorAll('.filtro-color:checked')).map(el => el.value);
    const minPrecio = parseFloat(document.getElementById('precio-min').value) || 0;
    const maxPrecio = parseFloat(document.getElementById('precio-max').value) || Infinity;
    const categoriaActiva = document.querySelector('.filtro-categoria.filtro-activo')?.dataset.categoria;

    document.querySelectorAll('.producto-item').forEach(item => {
      const material = item.dataset.material;
      const color = item.dataset.color;
      const precio = parseFloat(item.dataset.precio);
      const categoria = item.dataset.categoria;

      const mostrar = 
        (materiales.length === 0 || materiales.includes(material)) &&
        (colores.length === 0 || colores.includes(color)) &&
        precio >= minPrecio && precio <= maxPrecio &&
        (!categoriaActiva || categoriaActiva === categoria);

      item.style.display = mostrar ? 'block' : 'none';
    });
  }

  // Eventos
  document.querySelectorAll('.filtro-material, .filtro-color').forEach(el => el.addEventListener('change', filtrarProductos));
  document.getElementById('filtrar-precio').addEventListener('click', filtrarProductos);

  document.querySelectorAll('.filtro-categoria').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filtro-categoria').forEach(b => b.classList.remove('filtro-activo'));
      btn.classList.add('filtro-activo');
      filtrarProductos();
    });
  });

  document.getElementById('reset-categoria').addEventListener('click', () => {
    document.querySelectorAll('.filtro-categoria').forEach(b => b.classList.remove('filtro-activo'));
    filtrarProductos();
  });
</script>
</body>
</html>
