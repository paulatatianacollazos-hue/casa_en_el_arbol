{% extends "cliente/admin_dashboard.html" %}
{% block title %}Detalle del Pedido{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
  .estado-linea {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    margin-bottom: 30px;
  }

  .estado-linea::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    height: 6px;
    width: 100%;
    background: #dee2e6;
    transform: translateY(-50%);
    z-index: 0;
    border-radius: 10px;
  }

  .estado-progreso {
    position: absolute;
    top: 50%;
    left: 0;
    height: 6px;
    width: {{ progreso }}%;
    background: #198754;
    transform: translateY(-50%);
    z-index: 1;
    border-radius: 10px;
    transition: width 0.6s ease;
  }

  .estado-item {
    text-align: center;
    z-index: 2;
    width: 25%;
  }

  .estado-icono {
    font-size: 1.8rem;
    padding: 10px;
    border-radius: 50%;
    color: white;
  }

  .estado-completado {
    background: #198754;
  }

  .estado-actual {
    background: #0d6efd;
  }

  .estado-pendiente {
    background: #adb5bd;
  }

  .estado-texto {
    margin-top: 8px;
    font-size: 0.9rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4" style="font-family: 'Poppins', sans-serif;">

  <!-- Bot√≥n volver atr√°s -->
  <button class="btn btn-link text-decoration-none mb-3" onclick="history.back()">
    <i class="bi bi-arrow-left"></i> Volver
  </button>

  <div class="card shadow-sm p-4">
    <h4 class="mb-4"><i class="bi bi-box-seam"></i> Pedido #{{ pedido.ID_Pedido }}</h4>

    <!-- üîπ L√≠nea de estado -->
    {% set estados = ["pendiente", "en proceso", "en reparto", "entregado"] %}
    {% set iconos = {
      "pendiente": "bi-hourglass-split",
      "en proceso": "bi-hammer",
      "en reparto": "bi-truck",
      "entregado": "bi-check-circle"
    } %}
    <div class="estado-linea">
      <div class="estado-progreso"></div>
      {% for estado in estados %}
        {% set clase = "estado-pendiente" %}
        {% if estados.index(estado) < estados.index(estado_actual) %}
          {% set clase = "estado-completado" %}
        {% elif estado == estado_actual %}
          {% set clase = "estado-actual" %}
        {% endif %}
        <div class="estado-item">
          <div class="estado-icono {{ clase }}">
            <i class="bi {{ iconos[estado] }}"></i>
          </div>
          <div class="estado-texto">{{ estado|capitalize }}</div>
        </div>
      {% endfor %}
    </div>

    <!-- üßç Datos -->
    <div class="row">
      <div class="col-md-6">
        <h5><i class="bi bi-person"></i> Cliente</h5>
        <ul class="list-unstyled">
          <li><strong>Nombre:</strong> {{ cliente.Nombre }} {{ cliente.Apellido }}</li>
          <li><strong>Correo:</strong> {{ cliente.Correo }}</li>
          <li><strong>Tel√©fono:</strong> {{ cliente.Telefono or 'N/A' }}</li>
          <li><strong>Direcci√≥n:</strong> {{ direccion.Direccion if direccion else 'Sin direcci√≥n registrada' }}</li>
        </ul>
      </div>
      <div class="col-md-6">
        <h5><i class="bi bi-person-badge"></i> Empleado asignado</h5>
        {% if empleado %}
          <ul class="list-unstyled">
            <li><strong>Nombre:</strong> {{ empleado.Nombre }} {{ empleado.Apellido }}</li>
            <li><strong>Tel√©fono:</strong> {{ empleado.Telefono or 'N/A' }}</li>
          </ul>
        {% else %}
          <p class="text-muted">A√∫n no se ha asignado un empleado.</p>
        {% endif %}
      </div>
    </div>

    <hr>

    <!-- üõçÔ∏è Productos -->
    <h5><i class="bi bi-cart"></i> Productos</h5>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Cantidad</th>
            <th>Color</th>
            <th>Material</th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos %}
          <tr>
            <td>{{ p.nombre }}</td>
            <td>{{ p.cantidad }}</td>
            <td>{{ p.color }}</td>
            <td>{{ p.material }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <hr>

    <p class="small text-muted mb-0">
      <strong>Fecha de pedido:</strong> {{ pedido.FechaPedido or '---' }}<br>
      <strong>Fecha de entrega:</strong> {{ pedido.FechaEntrega or '---' }}
    </p>

  </div>
</div>
{% endblock %}
