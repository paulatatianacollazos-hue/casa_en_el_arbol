<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pagos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="text-center mb-4">Resumen de tu compra</h2>

  <div id="carouselProductos" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner" id="carousel-content"></div>

    <button class="carousel-control-prev" type="button" data-bs-target="#carouselProductos" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselProductos" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>

  <div class="text-center mt-4">
    <h4>Total: <span id="total-pago" class="text-success">$0.00</span></h4>
    <button class="btn btn-success mt-3" id="confirmar-pago">Confirmar pago</button>
  </div>
</div>

<script src="{{ url_for('static', filename='js/carrito.js') }}"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const carouselContent = document.getElementById("carousel-content");
    const totalPago = document.getElementById("total-pago");

    const productos = JSON.parse(localStorage.getItem(getCartKey())) || [];

    if (productos.length === 0) {
      carouselContent.innerHTML = `<div class="text-center p-5">No hay productos en tu carrito.</div>`;
      totalPago.textContent = "$0.00";
      return;
    }

    let total = 0;

    carouselContent.innerHTML = productos.map((p, i) => {
      const subtotal = (p.price || 0) * (p.quantity || 1);
      total += subtotal;

      return `
        <div class="carousel-item ${i === 0 ? 'active' : ''}">
          <div class="d-flex flex-column align-items-center">
            <img src="${p.image}" class="d-block" style="width:300px; height:300px; object-fit:cover; border-radius:10px;">
            <div class="mt-3 text-center">
              <h5>${p.name}</h5>
              <p class="text-muted">Cantidad: ${p.quantity || 1}</p>
              <p class="fw-bold text-success">$${subtotal.toFixed(2)}</p>
            </div>
          </div>
        </div>
      `;
    }).join("");

    totalPago.textContent = "$" + total.toFixed(2);

    document.getElementById("confirmar-pago").addEventListener("click", () => {
      alert("✅ Pago confirmado con éxito. ¡Gracias por tu compra!");
      localStorage.removeItem(getCartKey());
      window.location.href = "/catalogo";
    });
  });
</script>

</body>
</html>
