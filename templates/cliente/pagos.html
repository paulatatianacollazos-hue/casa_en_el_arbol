<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Confirmar Pago</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container py-5">
    <h2 class="text-center mb-4">ðŸ›’ Confirmar Pago</h2>

    <!-- Contenedor de productos -->
    <div id="productos-pago" class="row g-4 mb-4"></div>

    <!-- Total -->
    <div class="text-end mt-4">
      <h4>Total a pagar: <span id="total-pago" class="text-success fw-bold">$0.00</span></h4>
      <button id="confirmar-pago" class="btn btn-success mt-3 px-4">
        Confirmar compra
      </button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/cart.js') }}"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const productosContainer = document.getElementById("productos-pago");
      const totalPagoEl = document.getElementById("total-pago");

      const productos = JSON.parse(localStorage.getItem(getCartKey())) || [];
      console.log("ðŸ§¾ Productos en carrito:", productos);

      if (productos.length === 0) {
        productosContainer.innerHTML = `
          <div class="alert alert-info text-center">
            No hay productos en tu carrito.
            <a href="/catalogo" class="alert-link">Volver al catÃ¡logo</a>
          </div>`;
        totalPagoEl.textContent = "$0.00";
        return;
      }

      let total = 0;
      productosContainer.innerHTML = productos.map(p => {
        const subtotal = (p.price || 0) * (p.quantity || 1);
        total += subtotal;

        return `
          <div class="col-md-4 col-lg-3">
            <div class="card h-100 shadow-sm border-0">
              <img src="${p.image}" class="card-img-top" style="height:200px; object-fit:cover;">
              <div class="card-body text-center">
                <h5 class="card-title mb-1">${p.name}</h5>
                <p class="text-muted mb-1">Cantidad: ${p.quantity || 1}</p>
                <p class="fw-bold text-success">$${subtotal.toFixed(2)}</p>
              </div>
            </div>
          </div>
        `;
      }).join("");

      totalPagoEl.textContent = "$" + total.toFixed(2);

      document.getElementById("confirmar-pago").addEventListener("click", () => {
        alert("âœ… Pago confirmado correctamente. Â¡Gracias por tu compra!");
        localStorage.removeItem(getCartKey());
        window.location.href = "/catalogo";
      });
    });
  </script>
</body>
</html>
