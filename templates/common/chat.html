<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Chat en vivo</title>
    <script>
        async function enviarMensaje() {
            const texto = document.getElementById('texto').value;
            await fetch('{{ url_for(request.blueprint + ".enviar_mensaje_" + request.blueprint) }}', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ texto })
            });
            document.getElementById('texto').value = '';
            obtenerMensajes();
        }

        async function obtenerMensajes() {
            const res = await fetch('{{ url_for(request.blueprint + ".obtener_mensajes_" + request.blueprint) }}');
            const data = await res.json();
            const contenedor = document.getElementById('mensajes');
            contenedor.innerHTML = data.map(m => `<p><b>${m.usuario}:</b> ${m.texto}</p>`).join('');
        }

        setInterval(obtenerMensajes, 2000);
    </script>
</head>
<body>
    <h2>Chat entre Cliente y Administrador</h2>
    <div id="mensajes" style="border:1px solid #ccc; height:300px; overflow-y:auto;"></div>
    <br>
    <input type="text" id="texto" placeholder="Escribe un mensaje">
    <button onclick="enviarMensaje()">Enviar</button>
</body>
</html>
