{% extends "empleado/dashboard.html" %}

{% block title %}Calendario | Casa en el √Årbol{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background-color: #f8f9fa;
    overflow-x: hidden;
  }

  /* ========== MEN√ö LATERAL ========== */
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    width: 230px;
    background-color: #198754;
    color: white;
    padding-top: 1rem;
  }

  .sidebar a {
    color: white;
    text-decoration: none;
    display: block;
    padding: 10px 20px;
    transition: 0.3s;
  }

  .sidebar a:hover {
    background-color: #157347;
  }

  /* ========== CALENDARIO ========== */
  .calendar-container {
    margin-left: 250px;
    padding: 2rem;
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .calendar-header h2 {
    font-weight: 600;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-top: 1rem;
  }

  .day {
    background-color: white;
    border-radius: 10px;
    padding: 10px;
    height: 110px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    position: relative;
    cursor: pointer;
    transition: 0.2s;
  }

  .day:hover {
    transform: scale(1.02);
  }

  .day-header {
    font-weight: 600;
    font-size: 0.9rem;
  }

  .event {
    font-size: 0.8rem;
    border-radius: 5px;
    color: white;
    padding: 2px 6px;
    margin-top: 4px;
    display: inline-block;
  }

  .event.entrega { background-color: #28a745; }
  .event.reunion { background-color: #dc3545; }
  .event.instalacion { background-color: #007bff; }

  /* ========== PANEL DERECHO ========== */
  .info-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: 300px;
    height: 100%;
    background-color: white;
    box-shadow: -2px 0 6px rgba(0,0,0,0.1);
    padding: 1rem;
    overflow-y: auto;
  }

  .info-panel h4 {
    font-weight: 600;
  }

  .btn-success {
    width: 100%;
    border-radius: 10px;
  }
</style>
{% endblock %}


{% block content %}
<div class="sidebar">
  <h4 class="text-center">Men√∫</h4>
  <a href="#">üìÖ Calendario</a>
  <a href="#">üì¶ Pedidos</a>
  <a href="#">üßæ Reportes</a>
  <a href="#">‚öôÔ∏è Configuraci√≥n</a>
</div>

<div class="calendar-container">
  <div class="calendar-header mb-3">
    <div>
      <button id="btn-hoy" class="btn btn-outline-success btn-sm">Hoy</button>
      <button id="btn-mes" class="btn btn-outline-success btn-sm">Mes</button>
      <button id="btn-dia" class="btn btn-outline-success btn-sm">D√≠a</button>
    </div>
    <h2 id="titulo-mes"></h2>
  </div>

  <div class="calendar-grid" id="calendar-grid">
    <!-- Se genera din√°micamente con JS -->
  </div>
</div>

<div class="info-panel">
  <button class="btn btn-success mb-3" id="btn-subir">Subir tarea</button>

  <h4>Detalle de la tarea</h4>
  <p><strong>Fecha:</strong> <span id="detalle-fecha">‚Äî</span></p>
  <p><strong>Hora:</strong> <span id="detalle-hora">‚Äî</span></p>
  <p><strong>Ubicaci√≥n:</strong> <span id="detalle-ubicacion">‚Äî</span></p>
  <p><strong>Asignado a:</strong> <span id="detalle-usuario">‚Äî</span></p>
  <p><strong>Estado:</strong> <span id="detalle-estado" class="text-warning">En proceso</span></p>

  <div class="d-flex justify-content-between mt-3">
    <button class="btn btn-outline-primary btn-sm">Editar</button>
    <button class="btn btn-outline-danger btn-sm">Eliminar</button>
  </div>
</div>
{% endblock %}


{% block extra_footer %}
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const grid = document.getElementById("calendar-grid");
  const tituloMes = document.getElementById("titulo-mes");

  const meses = [
    "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
    "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
  ];

  const fechaActual = new Date();
  const a√±o = fechaActual.getFullYear();
  const mes = fechaActual.getMonth();
  tituloMes.textContent = `${meses[mes]} ${a√±o}`;

  const primerDiaMes = new Date(a√±o, mes, 1);
  const ultimoDiaMes = new Date(a√±o, mes + 1, 0);
  const diasMes = ultimoDiaMes.getDate();

  // Llenar cuadr√≠cula
  grid.innerHTML = "";
  for (let i = 1; i <= diasMes; i++) {
    const celda = document.createElement("div");
    celda.classList.add("day");
    celda.innerHTML = `<div class='day-header'>${i}</div>`;
    grid.appendChild(celda);
  }

  // Cargar eventos desde backend
  try {
    const response = await fetch("/calendario/eventos");
    const eventos = await response.json();

    eventos.forEach(ev => {
      const fecha = new Date(ev.Fecha);
      const dia = fecha.getDate();
      const celda = grid.children[dia - 1];
      if (celda) {
        const tipo = ev.Tipo.toLowerCase();
        const clase =
          tipo.includes("entrega") ? "entrega" :
          tipo.includes("reunion") || tipo.includes("evento") ? "reunion" :
          "instalacion";
        celda.innerHTML += `<div class="event ${clase}">${ev.Tipo}</div>`;
      }
    });
  } catch (error) {
    console.error("Error cargando eventos:", error);
  }
});
</script>
{% endblock %}
