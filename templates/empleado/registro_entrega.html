{% extends "empleado/dashboard.html" %}
{% block content %}

<div class="container mt-5">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">游닍 Registro de Entrega - Pedido #{{ pedido_id }}</h5>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
          <label class="form-label">Comentario del instalador</label>
          <textarea class="form-control" name="comentario" rows="3" required></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Subir fotos de la entrega (m치ximo 3)</label>

          <!-- Contenedor de inputs din치micos -->
          <div id="contenedor-fotos">
            <div class="input-group mb-2 foto-input">
              <input type="file" class="form-control" name="fotos" accept="image/*" required>
              <button type="button" class="btn btn-outline-danger btn-quitar">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
          </div>

          <button type="button" id="btn-agregar-foto" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-plus-circle"></i> Agregar otra imagen
          </button>

          <div id="limite-msg" class="text-danger small mt-2" style="display:none;">
            丘멆잺 Solo puedes subir un m치ximo de 3 im치genes.
          </div>
        </div>

        <div class="text-end mt-4">
          <button type="submit" class="btn btn-success">
            <i class="bi bi-save"></i> Guardar registro
          </button>
          <button type="button" class="btn btn-outline-secondary d-flex align-items-center gap-2"
            onclick="volverAtras()">
            <i class="bi bi-arrow-left"></i> Volver
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const contenedor = document.getElementById("contenedor-fotos");
  const btnAgregar = document.getElementById("btn-agregar-foto");
  const limiteMsg = document.getElementById("limite-msg");

  // 游댳 Agregar un nuevo input de imagen (hasta 3)
  btnAgregar.addEventListener("click", () => {
    const totalInputs = contenedor.querySelectorAll(".foto-input").length;
    if (totalInputs >= 3) {
      limiteMsg.style.display = "block";
      return;
    }
    limiteMsg.style.display = "none";

    const div = document.createElement("div");
    div.classList.add("input-group", "mb-2", "foto-input");
    div.innerHTML = `
      <input type="file" class="form-control" name="fotos" accept="image/*" required>
      <button type="button" class="btn btn-outline-danger btn-quitar">
        <i class="bi bi-x-lg"></i>
      </button>
    `;
    contenedor.appendChild(div);
  });

  // 游댳 Quitar un input de imagen
  contenedor.addEventListener("click", (e) => {
    if (e.target.closest(".btn-quitar")) {
      const totalInputs = contenedor.querySelectorAll(".foto-input").length;
      e.target.closest(".foto-input").remove();
      if (totalInputs <= 3) limiteMsg.style.display = "none";
    }
  });
});
</script>
<script>
  function volverAtras() {
    if (window.history.length > 1) {
      window.history.back(); // 游댳 Regresa a la p치gina anterior sin recargar toda la app
    } else {
      // Si no hay historial (por ejemplo, acceso directo)
      window.location.href = "/"; // Cambia esta ruta a tu home o panel principal
    }
  }
</script>
{% endblock %}
