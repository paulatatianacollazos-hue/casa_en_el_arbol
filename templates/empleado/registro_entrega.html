{% extends "empleado/dashboard.html" %}
{% block content %}

<!-- 游댳 Vista principal -->
<div id="vista-principal">

<div class="container mt-5">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">游닍 Registro de Entrega - Pedido #{{ pedido_id }}</h5>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
          <label class="form-label">Comentario del instalador</label>
          <textarea class="form-control" name="comentario" rows="3" required></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Subir fotos de la entrega (m치ximo 3)</label>

          <div id="contenedor-fotos-principal">
            <div class="input-group mb-2 foto-input">
              <input type="file" class="form-control" name="fotos" accept="image/*" required>
              <button type="button" class="btn btn-outline-danger btn-quitar">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
          </div>

          <button type="button" id="btn-agregar-foto-principal" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-plus-circle"></i> Agregar otra imagen
          </button>

          <div id="limite-msg-principal" class="text-danger small mt-2" style="display:none;">
            丘멆잺 Solo puedes subir un m치ximo de 3 im치genes.
          </div>
        </div>

        <div class="text-end mt-4">

          <!-- 游댳 Cambiado a type="button" -->
          <button type="button" id="btn-personalizar" class="btn btn-primary">
            Instalaci칩n
          </button>

          <button type="submit" class="btn btn-success">
            <i class="bi bi-save"></i> Guardar registro
          </button>
          
          <button type="button" class="btn btn-outline-secondary" onclick="volverAtras()">
            <i class="bi bi-arrow-left"></i> Volver
          </button>

        </div>

      </form>
    </div>
  </div>
</div>

</div> <!-- cierre vista principal -->


<!-- 游댳 Vista Personalizada -->
<div id="seccion-personalizar" class="d-none">

<div class="container mt-5">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">游닍 Registro de Entrega - Pedido #{{ pedido_id }}</h5>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
          <label class="form-label">Comentario del instalador</label>
          <textarea class="form-control" name="comentario" rows="3" required></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Subir fotos de la entrega (m치ximo 3)</label>

          <div id="contenedor-fotos-principal">
            <div class="input-group mb-2 foto-input">
              <input type="file" class="form-control" name="fotos" accept="image/*" required>
              <button type="button" class="btn btn-outline-danger btn-quitar">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
          </div>

          <button type="button" id="btn-agregar-foto-principal" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-plus-circle"></i> Agregar otra imagen
          </button>

          <div id="limite-msg-principal" class="text-danger small mt-2" style="display:none;">
            丘멆잺 Solo puedes subir un m치ximo de 3 im치genes.
          </div>
        </div>

        <div class="text-end mt-4">

          <!-- 游댳 Cambiado a type="button" -->

          <button type="submit" class="btn btn-success">
            <i class="bi bi-save"></i> Guardar registro
          </button>
          
          <button type="button" class="btn btn-outline-secondary" onclick="volverAtras()">
            <i class="bi bi-arrow-left"></i> Volver
          </button>

        </div>

      </form>
    </div>
  </div>
</div>

</div>


<!-- 游댳 Script manejo de fotos -->
<script>
function activarFotoManager(prefix) {
  const contenedor = document.getElementById(`contenedor-fotos-${prefix}`);
  const btnAgregar = document.getElementById(`btn-agregar-foto-${prefix}`);
  const limiteMsg = document.getElementById(`limite-msg-${prefix}`);

  btnAgregar.addEventListener("click", () => {
    const totalInputs = contenedor.querySelectorAll(".foto-input").length;

    if (totalInputs >= 3) {
      limiteMsg.style.display = "block";
      return;
    }

    limiteMsg.style.display = "none";

    const div = document.createElement("div");
    div.classList.add("input-group", "mb-2", "foto-input");
    div.innerHTML = `
      <input type="file" class="form-control" name="fotos" accept="image/*" required>
      <button type="button" class="btn btn-outline-danger btn-quitar">
        <i class="bi bi-x-lg"></i>
      </button>
    `;
    contenedor.appendChild(div);
  });

  contenedor.addEventListener("click", (e) => {
    if (e.target.closest(".btn-quitar")) {
      e.target.closest(".foto-input").remove();
      limiteMsg.style.display = "none";
    }
  });
}

// activar para la vista principal
document.addEventListener("DOMContentLoaded", () => {
  activarFotoManager("principal");
});
</script>

<!-- 游댳 Script para alternar vistas -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btnPersonalizar = document.getElementById("btn-personalizar");
  const btnVolver = document.getElementById("btn-volver");

  const vista = document.getElementById("vista-principal");
  const personalizar = document.getElementById("seccion-personalizar");

  btnPersonalizar.addEventListener("click", () => {
    vista.classList.add("d-none");
    personalizar.classList.remove("d-none");
  });

  btnVolver.addEventListener("click", () => {
    personalizar.classList.add("d-none");
    vista.classList.remove("d-none");
  });
});
</script>

<script>
function volverAtras() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = "/";
  }
}
</script>

{% endblock %}
